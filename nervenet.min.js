/* nervenet ver.0.1.8  (c) 2013 Meathill  MIT
 build at 2014-09-19 02:09:59*/

!function(a){function b(a){return k.call(a)===l}function c(a){return a===Object(a)&&k.call(a)===m}function d(a){return k.call(a)===n}function e(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function f(a){function b(){}return b.prototype=a,new b}function g(a,b){var c=f(a.prototype);c.constructor=b,b.prototype=c}function h(a){for(var b=j.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a}function i(b,c){if(!b)return!1;for(var d=b.split("."),c=c||a,f=0,g=d.length;g>f;f++){if(!(d[f]in c)||e(c[d[f]]))return!1;c=c[d[f]]}return c}if(!a.Nervenet){var j=Array.prototype.slice,k=Object.prototype.toString,l="[object Function]",m="[object Object]",n="[object String]",o={},p=(a.Nervenet={VERSION:"0.1.8",createContext:function(){return new s},createNameSpace:function(b,c){var d=b.split("."),c=c||a;o[b]=c;for(var e=0,f=d.length;f>e;e++)c[d[e]]=c[d[e]]||{},c=c[d[e]];return c},inherit:g,parseNamespace:i,setConfig:function(a,b){a in p&&(p[a]=b)}},{dir:"js",injectPrefix:"$"}),q=function(){this.maps={}},r={force:!1,isSingle:!1};q.errors={EXIST:"[Error Nervenet.mediator.map] The selector already exists, you cannot map 2 classes for 1 selector."},q.prototype={$context:null,isBackbone:!1,check:function(a){var b=a.matches||a.matchesSelector||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;for(var c in this.maps){b&&b.call(a,c)&&this.preCheck(a,c);var d=a.querySelectorAll(c);0!==d.length&&this.preCheck(d,c)}},preCheck:function(a,b){var c=this.maps[b];if(c.isSingle)c.instance&&"setElement"in c.instance?c.instance.setElement(a):c.instance=this.createMediator(a,c.klass,c.options);else{c.instance=c.instance||[];for(var d=0,e=a.length;e>d;d++){var f=this.createMediator(a[d],c.klass,c.options);c.instance.push(f)}}},createMediator:function(a,b,c){var d=this.isBackbone?h({el:a},c):a,e=this.$context.createInstance(b,d,c);return e},getVO:function(a){return this.maps[a]},hasMap:function(a){return!!this.maps[a]},map:function(a,b,c){var d=this.maps[a],e=h({},r,c);if(d&&d.klass!==b){if(!e.force)throw new Error(q.errors.EXIST);d.instance=null}return this.maps[a]={klass:b,isSingle:e.isSingle,options:c},this},removeMap:function(a){this.maps[a]=null}};var s=function(){this.mappings={},this.eventMap={},this.valueMap={},this.config=h({},p),this.mediatorMap=new q,this.mapValue("context",this),this.mapValue("mediatorMap",this.mediatorMap),this.inject(this.mediatorMap)},t=function(a,b){this.klass=a,this.instance=b};s.errors={NOT_EXIST:"[Error Nervenet.context.getSingleton] the key doesn't exist",NOT_A_CLASS:"[Error Nervenet.context.mapClass] the second parameter is invalid, a class is expected",SOMETHING_EXIST:"[Error Nerver.context.mapClass/mapSingleton/mapValue] the mapping already exist"},s.prototype={createInstance:function(a){for(var b=j.call(arguments,1),e=0,g=b.length;g>e;e++)c(b[e])?this.inject(b[e]):d(b[e])&&(b[e]=this.getInjectValue(b[e]));a=d(a)?this.getClass(a):a;var h="create"in Object?Object.create(a.prototype):f(a.prototype);return this.inject(h),a.apply(h,b),h},getClass:function(a){return this.mappings[a].klass},getInjectValue:function(a,c){var e="$"===this.config.injectPrefix?"\\$":this.config.injectPrefix,f=new RegExp("^"+e+"([\\w\\-]+)$"),g=new RegExp("^{{"+e+"([\\w\\-\\.]+)}}$");if(d(c)&&g.test(c)){var h=c.match(g)[1],j=this.getValue(h)||h in this.mappings&&this.getSingleton(h);if(j)return j;var k=i(h);if(k){if(b(k)){for(h in this.mappings)if(this.mappings.hasOwnProperty(h)&&this.getClass(h)===k)return this.getSingleton(h)?this.getSingleton(h):(j=this.createInstance(h),this.mapSingleton(h,j),j);return j=this.createInstance(k),this.mapSingleton(c,k,j),j}return this.mapValue(c,k),k}}if(f.test(a)){if(a=a.match(f)[1],a in this.valueMap)return this.getValue(a);if(a in this.mappings)return this.getSingleton(a)}return 1===arguments.length?a:c},getSingleton:function(a){if(!(a in this.mappings))throw new Error(s.errors.NOT_EXIST);if(!this.mappings[a].instance){var b=j.call(arguments,1);b.unshift(a),this.mappings[a].instance=this.createInstance.apply(this,b)}return this.mappings[a].instance},getValue:function(a){return this.valueMap[a]},hasMapping:function(a){return a in this.mappings},hasValue:function(a){return a in this.valueMap},inject:function(a){for(var c in a)a[c]=this.getInjectValue(c,a[c]);if("postConstruct"in a&&b(a.postConstruct)){var d=j.call(arguments,1);a.postConstruct.apply(a,d)}return this},mapClass:function(a,c){if(!b(c))throw new Error(s.errors.NOT_A_CLASS);if(this.hasMapping(a))throw new Error(s.errors.SOMETHING_EXIST);return this.mappings[a]=new t(c),this},mapEvent:function(a,b,c){return this.eventMap[a]=this.eventMap[a]||[],this.eventMap[a].push({command:b,context:c}),this},mapSingleton:function(a,c,d){if(this.hasMapping(a))throw new Error(s.errors.SOMETHING_EXIST);if(d){if(d instanceof c)this.mappings[a]=new t(c,d);else{var e=j.call(arguments,1);d=this.createInstance.apply(this,e),this.mappings[a]=new t(c,d)}return this}return this.mappings[a]=b(c)?new t(c):new t(null,c),this},mapValue:function(a,b,c){if(!c&&this.hasValue(a))throw new Error(s.errors.SOMETHING_EXIST);return this.valueMap[a]=b,this},removeEvent:function(a,b,c){var d,e,f,g;if(!a&&!b&&!c)return this.eventMap=void 0,this;for(var h in this.eventMap)if(!a||a===h){if(e=this.eventMap[h],this.eventMap[h]=d=[],b||c)for(f=0,g=e.length;g>f;f++)a=e[f],(b&&b!==a.command||c&&c!==a.context)&&d.push(a);d.length||delete this.eventMap[h]}return this},removeMapping:function(a){this.mappings[a]=null,delete this.mappings[a]},removeValue:function(a){this.valueMap[a]=null,delete this.valueMap[a]},start:function(a){Packager.start(a,this)},trigger:function(a){if(a in this.eventMap){var b=j.call(arguments,1),c=this.eventMap[a];b.push(this);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.command.apply(f.context||this,b)}}}}}}(this);
//# sourceMappingURL=nervenet.min.js.map