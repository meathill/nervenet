/* nervenet ver.0.1.2  (c) 2013 Meathill  MIT
 build at 2014-02-08 05:02:14*/

!function(a){function b(a){return"isArray"in Array?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function c(a){return"[object Function]"===m.call(a)}function d(a){return a===Object(a)}function e(a){return"[object String]"===m.call(a)}function f(a){function b(){}return b.prototype=a,new b}function g(a,b){var c=f(a.prototype);c.constructor=b,b.prototype=c}function h(a){for(var b=l.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a}function i(b,c){if(!b)return!1;for(var d=b.split("."),c=c||a,e=0,f=d.length;f>e;e++){if(!(d[e]in c))return!1;c=c[d[e]]}return c}function j(a){return o.dir+"/"+a.split(".").join("/")+".js"}function k(a,b){b=b||"";var c=document.createElement("script");c.className="nervenet "+b,c.innerHTML=a,z?y.insertBefore(c,z):y.appendChild(c)}if(!a.Nervenet){var l=Array.prototype.slice,m=Object.prototype.toString,n={},o=(a.Nervenet={VERSION:"0.1.2",createContext:function(){return new r},createNameSpace:function(b,c){var d=b.split("."),c=c||a;n[b]=c;for(var e=0,f=d.length;f>e;e++)c[d[e]]=c[d[e]]||{},c=c[d[e]];return c},inherit:g,parseNamespace:i,setConfig:function(a,b){a in o&&(o[a]=b)}},{dir:"js",injectPrefix:"$"}),p=function(){this.maps={}},q={force:!1,isSingle:!1};p.errors={EXIST:"[Error Nervenet.mediator.map] The selector already exists, you cannot map 2 classes for 1 selector."},p.prototype={$context:null,isBackbone:!1,check:function(a){for(var b in this.maps){var c=a.querySelectorAll(b),d=this.maps[b];if(d.isSingle)d.instance&&"setElement"in d.instance?d.instance.setElement(c):d.instance=this.createMediator(c,d.klass,d.options);else{d.instance=d.instance||[];for(var e=0,f=c.length;f>e;e++){var g=this.createMediator(c[e],d.klass,d.options);d.instance.push(g)}}}},createMediator:function(a,c,d){var e;if(b(d))e="create"in Object?Object.create(c.prototype):f(c.prototype),d.unshift(a),c.apply(e,d);else{var g=this.isBackbone?h({el:a},d):a;e=new c(g,d)}return this.$context&&this.$context.inject(e),e},getVO:function(a){return this.maps[a]},hasMap:function(a){return!!this.maps[a]},map:function(a,b,c){var d=this.maps[a],e=h({},q,c);if(d&&d.klass!==b){if(!e.force)throw new Error(p.errors.EXIST);d.instance=null}return this.maps[a]={klass:b,isSingle:e.isSingle,options:c},this},removeMap:function(a){this.maps[a]=null}};var r=function(){this.mappings={},this.eventMap={},this.valueMap={},this.config=h({},o),this.mediatorMap=new p,this.mapValue("context",this),this.mapValue("mediatorMap",this.mediatorMap)},s=function(a,b){this.klass=a,this.instance=b};r.errors={NOT_EXIST:"[Error Nervenet.context.getSingleton] the key doesn't exist",NOT_A_CLASS:"[Error Nervenet.context.mapClass] the second parameter is invalid, a class is expected",SOMETHING_EXIST:"[Error Nerver.context.mapClass/mapSingleton/mapValue] the mapping already exist"},r.prototype={createInstance:function(a){for(var b=l.call(arguments,1),c=0,g=b.length;g>c;c++)d(b[c])?this.inject(b[c]):e(b[c])&&(b[c]=this.getInjectValue(b[c]));a=e(a)?this.getClass(a):a;var h="create"in Object?Object.create(a.prototype):f(a.prototype);return a.apply(h,b),this.inject(h),h},getClass:function(a){return this.mappings[a].klass},getInjectValue:function(a,b){var d="$"===this.config.injectPrefix?"\\$":this.config.injectPrefix,f=new RegExp("^"+d+"([\\w\\-]+)$"),g=new RegExp("^{{"+d+"([\\w\\-]+)}}$");if(e(b)&&b.length>0){if(g.test(b)){var h=b.match(g)[1];return this.getValue(h)||h in this.mappings&&this.getSingleton(h)}var j=i(b);if(j){if(!c(j))return this.mapValue(b,j),j;var k=!1;for(var h in this.mappings)if(this.getClass(h)===j){if(this.getSingleton(h))return this.getSingleton(h);var l=this.createInstance(h);return this.mapSingleton(h,l),l}if(!k){var l=this.createInstance(j);return this.mapSingleton(b,j,l),l}}}if(f.test(a)){var a=a.match(f)[1];if(a in this.valueMap)return this.getValue(a);if(a in this.mappings)return this.getSingleton(a)}return b||a},getSingleton:function(a){if(!(a in this.mappings))throw new Error(r.errors.NOT_EXIST);if(!this.mappings[a].instance){var b=l.call(arguments,1);b.unshift(a),this.mappings[a].instance=this.createInstance.apply(this,b)}return this.mappings[a].instance},getValue:function(a){return this.valueMap[a]},hasMapping:function(a){return a in this.mappings},hasValue:function(a){return a in this.valueMap},inject:function(a){for(var b in a)a[b]=this.getInjectValue(b,a[b]);if(a.postConstruct&&c(a.postConstruct)){var d=l.call(arguments,1);a.postConstruct.apply(a,d)}return this},mapClass:function(a,b){if(!c(b))throw new Error(r.errors.NOT_A_CLASS);if(this.hasMapping(a))throw new Error(r.errors.SOMETHING_EXIST);return this.mappings[a]=new s(b),this},mapEvent:function(a,b,c){this.eventMap[a]=this.eventMap.event||[],this.eventMap[a].push({command:b,context:c})},mapSingleton:function(a,b,d){if(this.hasMapping(a))throw new Error(r.errors.SOMETHING_EXIST);if(d){if(d instanceof b)this.mappings[a]=new s(b,d);else{var e=l.call(arguments,1);d=this.createInstance.apply(this,e),this.mappings[a]=new s(b,d)}return this}return this.mappings[a]=c(b)?new s(b):new s(null,b),this},mapValue:function(a,b){if(this.hasValue(a))throw new Error(r.errors.SOMETHING_EXIST);return this.valueMap[a]=b,this},removeMapping:function(a){this.mappings[a]=null,delete this.mappings[a]},removeValue:function(a){this.valueMap[a]=null,delete this.valueMap[a]},start:function(a){B.start(a,this)},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.eventMap[a];b.push(this);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.command.apply(f.context,b)}}};var t=/(import|extend) ((\w+\.)+(\w+))/gi,u=0,v=[],w=[],x={},y=document.getElementsByTagName("head")[0]||document.documentElement,z=y.getElementsByTagName("base")[0],A=new XMLHttpRequest;A.onload=function(){v[u].content=this.response,B.parse(this.response),u++,B.loadNext()};var B={createNodes:function(){for(var a=0,b=w.length;b>a;a++)for(var c=0,d=v.length;d>c;c++)if(v[c].fullname===w[a]){k(v[c].content,v[c].className),v.splice(c,1);break}"func"in x&&x.func.call(x.context)},loadNext:function(){return u>=v.length?void this.createNodes():(A.open("get",j(v[u].fullname)),void A.send())},parse:function(a){c(a)&&(a=a.toString());var b=a.match(t);if(b)for(var d=0,e=b.length;e>d;d++){var f=b[d].slice(7);if(-1===w.indexOf(f)){var g={fullname:f,className:f.slice(f.lastIndexOf(".")+1),type:b[d].substr(0,6),content:""};if(v.push(g),"import"===g.type)w.push(f);else{var h=v[u].fullname,i=w.indexOf(h);w.splice(i,0,f)}}}},reset:function(){u=0,w=[],v=[]},start:function(a,b){this.reset(),x={func:a,context:b},this.parse(a),this.loadNext()}}}}(this);
//# sourceMappingURL=nervenet.min.map