/* NerveNet ver.0.1.0  (c) 2013 Meathill  MIT*/
!function(a){function b(a){return"[object Function]"===i.call(a)}function c(a){return"[object String]"===i.call(a)}function d(a){for(var b=h.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a}function e(b){if(!b)return!1;for(var c=b.split("."),d=a[c[0]],e=1,f=c.length;f>e;e++){if(!(c[e]in d))return!1;d=d[c[e]]}return d}function f(a){return k.dir+"/"+a.split(".").join("/")+".js"}function g(a,b){b=b||"";var c=document.createElement("script");c.className="nervenet "+b,c.innerHTML=a,t?s.insertBefore(c,t):s.appendChild(c)}if(!a.Nervenet){var h=Array.prototype.slice,i=Object.prototype.toString,j={};a.Nervenet={VERSION:"0.1.0",createContext:function(){return new l},createNameSpace:function(b,c){var d=b.split("."),c=c||a;j[b]=c;for(var e=0,f=d.length;f>e;e++)c[d[e]]=c[d[e]]||{},c=c[d[e]];return c}};var k={dir:"js",injectPrefix:"$"},l=function(){this.singletons={},this.constructors={},this.eventMap={},this.voMap={},this.config=d({},k)},m={NOT_A_CLASS:"[Error Nervenet.context.mapClass] the second parameter is invalid, a class is expected",SOMETHING_EXIST:"[Error Nerver.context.mapClass/mapSingleton/mapValue] the mapping already exist"};l.prototype={createInstance:function(a){var b=h.call(arguments,1);a=c(a)?this.getClass(a):a;var d=new a(b);return this.inject(d),d},getClass:function(a){return this.constructors[a]},getSingleton:function(a){if(!(a in this.singletons)){if(!(a in this.constructors))throw new Error("no such class");this.singletons[a]=this.createInstance(a)}return this.singletons[a]},getValue:function(a){return this.voMap[a]},hasClass:function(a){return a in this.constructors},hasSingleton:function(a){return a in this.singletons},hasValue:function(a){return a in this.voMap},inject:function(a){for(var d in a)if(c(a[d])&&0===d.indexOf(this.config.injectPrefix)){var f=d.substr(this.config.injectPrefix.length),g=a[d],h=e(g);if(h){if(!b(h)){this.mapValue(g,h),a[d]=h;continue}var i=!1;for(var j in this.constructors)if(this.getClass(j)===h){this.hasSingleton(j)?a[d]=this.getSingleton(j):(a[d]=this.createInstance(j),this.mapSingleton(j,a[d])),i=!0;break}if(!i){a[d]=this.createInstance(h),this.mapSingleton(g,h,a[d]);continue}}this.voMap.hasOwnProperty(f)?a[d]=this.getValue(f):this.singletons.hasOwnProperty(f)&&(a[d]=this.getSingleton(f))}return a.postConstruct&&b(a.postConstruct)&&a.postConstruct(),this},mapClass:function(a,c){if(!b(c))throw new Error(m.NOT_A_CLASS);if(this.hasClass(a))throw new Error(m.SOMETHING_EXIST);return this.constructors[a]=c,this},mapEvent:function(a,b,c){this.eventMap[a]=this.eventMap.event||[],this.eventMap[a].push({command:b,context:c})},mapSingleton:function(a,c,d){if(this.hasSingleton(a))throw new Error(m.SOMETHING_EXIST);return d&&(this.constructors[a]=c,this.singletons[a]=d),b(c)?this.constructors[a]=c:this.singletons[a]=c,this},mapValue:function(a,b){if(this.hasValue(a))throw new Error(m.SOMETHING_EXIST);return this.voMap[a]=b,this},removeClass:function(a){this.constructors[a]=null,delete this.constructors[a]},removeValue:function(a){this.voMap[a]=null,delete this.voMap[a]},start:function(a){v.start(a,this)},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.eventMap[a];b.push(this);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.command.apply(f.context,b)}}};var n=/(import|extend) ((\w+\.)+(\w+))/gi,o=-1,p=[],q=[],r={},s=document.getElementsByTagName("head")[0]||document.documentElement,t=s.getElementsByTagName("base")[0],u=new XMLHttpRequest;u.onload=function(){p[o].content=this.response,v.parse(this.response),v.loadNext()};var v={createNodes:function(){for(var a=0,b=q.length;b>a;a++){for(var c=0;b>c&&p[c].fullname!==q[a];c++);g(p[c].content,p[c].className),p.splice(c,1)}"func"in r&&r.func.call(r.context)},loadNext:function(){return o++,o>=p.length?(this.createNodes(),void 0):(u.open("get",f(p[o].fullname)),u.send(),void 0)},parse:function(a){b(a)&&(a=a.toString());var c=a.match(n);if(c)for(var d=0,e=c.length;e>d;d++){var f=c[d].slice(7);if(-1===q.indexOf(f)){var g={fullname:f,className:f.slice(f.lastIndexOf(".")+1),type:c[d].substr(0,6),content:""};if(p.push(g),"import"===g.type)q.push(f);else{for(var h=p[o].fullname,i=0;q[i]!==h;)i++;q.splice(i,0,f)}}}},reset:function(){q=[],p=[]},start:function(a,b){this.reset(),r={func:a,context:b},this.parse(a),this.loadNext()}}}}(this);
/*
//@ sourceMappingURL=Nervenet.min.map
*/