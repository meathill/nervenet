/* nervenet ver.0.1.1  (c) 2013 Meathill  MIT
 build at 2013-10-16 05:10:04*/ 
!function(a){function b(a){return"[object Function]"===l.call(a)}function c(a){return a===Object(a)}function d(a){return"[object String]"===l.call(a)}function e(a){function b(){}return b.prototype=a,new b}function f(a,b){var c=e(a.prototype);c.constructor=b,b.prototype=c}function g(a){for(var b=k.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a}function h(b,c){if(!b)return!1;for(var d=b.split("."),c=c||a,e=0,f=d.length;f>e;e++){if(!(d[e]in c))return!1;c=c[d[e]]}return c}function i(a){return n.dir+"/"+a.split(".").join("/")+".js"}function j(a,b){b=b||"";var c=document.createElement("script");c.className="nervenet "+b,c.innerHTML=a,x?w.insertBefore(c,x):w.appendChild(c)}if(!a.Nervenet){var k=Array.prototype.slice,l=Object.prototype.toString,m={};a.Nervenet={VERSION:"0.1.1",createContext:function(){return new o},createNameSpace:function(b,c){var d=b.split("."),c=c||a;m[b]=c;for(var e=0,f=d.length;f>e;e++)c[d[e]]=c[d[e]]||{},c=c[d[e]];return c},inherit:f,parseNamespace:h,setConfig:function(a,b){a in n&&(n[a]=b)}};var n={dir:"js",injectPrefix:"$"},o=function(){this.mappings={},this.eventMap={},this.valueMap={},this.config=g({},n),this.mapValue("context",this)},p=function(a,b){this.klass=a,this.instance=b},q={NOT_A_CLASS:"[Error Nervenet.context.mapClass] the second parameter is invalid, a class is expected",SOMETHING_EXIST:"[Error Nerver.context.mapClass/mapSingleton/mapValue] the mapping already exist"};o.prototype={createInstance:function(a){for(var b=k.call(arguments,1),f=0,g=b.length;g>f;f++)c(b[f])?this.inject(b[f]):d(b[f])&&(b[f]=this.getInjectValue(b[f]));a=d(a)?this.getClass(a):a;var h="create"in Object?Object.create(a.prototype):e(a.prototype);return a.apply(h,b),this.inject(h),h},getClass:function(a){return this.mappings[a].klass},getInjectValue:function(a,c){var e="$"===this.config.injectPrefix?"\\$":this.config.injectPrefix,f=new RegExp("^"+e+"([\\w\\-]+)$"),g=new RegExp("^{{"+e+"([\\w\\-]+)}}$");if(d(c)&&c.length>0){if(g.test(c)){var i=c.match(g)[1];return this.getValue(i)||i in this.mappings&&this.getSingleton(i)}var j=h(c);if(j){if(!b(j))return this.mapValue(c,j),j;var k=!1;for(var i in this.mappings)if(this.getClass(i)===j){if(this.getSingleton(i))return this.getSingleton(i);var l=this.createInstance(i);return this.mapSingleton(i,l),l}if(!k){var l=this.createInstance(j);return this.mapSingleton(c,j,l),l}}}if(f.test(a)){var a=a.match(f)[1];if(a in this.valueMap)return this.getValue(a);if(a in this.mappings)return this.getSingleton(a)}return c||a},getSingleton:function(a){if(!(a in this.mappings))throw new Error("no such class");if(!this.mappings[a].instance){var b=k.call(arguments,1);b.unshift(a),this.mappings[a].instance=this.createInstance.apply(this,b)}return this.mappings[a].instance},getValue:function(a){return this.valueMap[a]},hasMapping:function(a){return a in this.mappings},hasValue:function(a){return a in this.valueMap},inject:function(a){for(var c in a)a[c]=this.getInjectValue(c,a[c]);if(a.postConstruct&&b(a.postConstruct)){var d=k.call(arguments,1);a.postConstruct.apply(a,d)}return this},mapClass:function(a,c){if(!b(c))throw new Error(q.NOT_A_CLASS);if(this.hasMapping(a))throw new Error(q.SOMETHING_EXIST);return this.mappings[a]=new p(c),this},mapEvent:function(a,b,c){this.eventMap[a]=this.eventMap.event||[],this.eventMap[a].push({command:b,context:c})},mapSingleton:function(a,c,d){if(this.hasMapping(a))throw new Error(q.SOMETHING_EXIST);if(d){if(d instanceof c)this.mappings[a]=new p(c,d);else{var e=k.call(arguments,1);d=this.createInstance.apply(this,e),this.mappings[a]=new p(c,d)}return this}return this.mappings[a]=b(c)?new p(c):new p(null,c),this},mapValue:function(a,b){if(this.hasValue(a))throw new Error(q.SOMETHING_EXIST);return this.valueMap[a]=b,this},removeMapping:function(a){this.mappings[a]=null,delete this.mappings[a]},removeValue:function(a){this.valueMap[a]=null,delete this.valueMap[a]},start:function(a){z.start(a,this)},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.eventMap[a];b.push(this);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.command.apply(f.context,b)}}};var r=/(import|extend) ((\w+\.)+(\w+))/gi,s=0,t=[],u=[],v={},w=document.getElementsByTagName("head")[0]||document.documentElement,x=w.getElementsByTagName("base")[0],y=new XMLHttpRequest;y.onload=function(){t[s].content=this.response,z.parse(this.response),s++,z.loadNext()};var z={createNodes:function(){for(var a=0,b=u.length;b>a;a++)for(var c=0,d=t.length;d>c;c++)if(t[c].fullname===u[a]){j(t[c].content,t[c].className),t.splice(c,1);break}"func"in v&&v.func.call(v.context)},loadNext:function(){return s>=t.length?(this.createNodes(),void 0):(y.open("get",i(t[s].fullname)),y.send(),void 0)},parse:function(a){b(a)&&(a=a.toString());var c=a.match(r);if(c)for(var d=0,e=c.length;e>d;d++){var f=c[d].slice(7);if(-1===u.indexOf(f)){var g={fullname:f,className:f.slice(f.lastIndexOf(".")+1),type:c[d].substr(0,6),content:""};if(t.push(g),"import"===g.type)u.push(f);else{var h=t[s].fullname,i=u.indexOf(h);u.splice(i,0,f)}}}},reset:function(){s=0,u=[],t=[]},start:function(a,b){this.reset(),v={func:a,context:b},this.parse(a),this.loadNext()}}}}(this);
//# sourceMappingURL=Nervenet.min.map